#!/bin/sh

~/bin/log "Setting up environment..."

# set PATH
for dir in "/sbin" "/bin" "/usr/sbin" "/usr/bin" "/usr/local/sbin" "/usr/local/bin" "$HOME/bin" "$HOME/.cargo/bin"; do
	if [ -d "$dir" ]
	then
		PATH="$dir:$PATH"
	fi
done

# set os specific bin
case "$(uname)" in
	*"FreeBSD"*)
		if [ -d "$HOME/bin/freebsd" ]
		then
			PATH="$HOME/bin/freebsd:$PATH"
		fi
		;;
esac

# remove path duplicates
PATH=$(printf "%s" "$PATH" | awk -v RS=':' '!a[$1]++ { if (NR > 1) printf RS; printf $1 }')

# set EDITOR to most preferred available
for i in vim vi nano ; do
	[ -x "$(command -v $i)" ] || continue
	EDITOR="$(which $i)"
	break
done

# set JAVA variables
if [ -x "$(command -v javac)" ]
then
	JAVA_HOME="$(readlink -f /usr/bin/javac | sed 's:/bin/javac::')"
	CLASSPATH="$CLASSPATH:."
	# for DWM and other tilling wms
	_JAVA_AWT_WM_NONREPARENTING="1"
fi

# set PAGER
PAGER=less

# set DVTM_TERM for compatibility
DVTM_TERM="xterm"

# set ENV to local kshrc, possibly overrides symlinks
ENV="$HOME/etc/kshrc"

# export variables
export PATH HOME EDITOR JAVA_HOME CLASSPATH PAGER ENV DVTM_TERM _JAVA_AWT_WM_NONREPARENTING

~/bin/log "PATH:      $PATH"
~/bin/log "HOME:      $HOME"
~/bin/log "EDITOR:    $EDITOR"
~/bin/log "PAGER:     $PAGER"
~/bin/log "ENV:       $ENV"
~/bin/log "JAVA_HOME: $JAVA_HOME"
~/bin/log "CLASSPATH: $CLASSPATH"
~/bin/log "DVTM_TERM: $DVTM_TERM"

